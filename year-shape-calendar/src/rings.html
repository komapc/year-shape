<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Multi-Ring Calendar - YearWheel</title>
    <!-- Tailwind CSS for header styling -->
    <link rel="stylesheet" href="/style.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: linear-gradient(
          to bottom,
          #07101a,
          #0b1220
        ); /* Dark theme default */
        min-height: 100vh;
        margin: 0;
        padding: 0;
        color: white;
        overflow-x: hidden;
        max-width: 100vw;
        transition: background 0.3s ease, color 0.3s ease;
      }

      /* Light theme support */
      .light-theme body {
        background: linear-gradient(to bottom, #e0e7ff, #ffffff);
        color: #1f2937;
      }

      h1 {
        margin-bottom: 10px;
        font-size: 2rem;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .subtitle {
        margin-bottom: 20px;
        opacity: 0.9;
        font-size: 0.9rem;
      }


      #canvas-container {
        position: relative;
        width: 100%;
        max-width: 700px;
        aspect-ratio: 1;
        background: rgba(30, 30, 40, 0.95); /* Dark background for dark theme */
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        box-sizing: border-box;
        transition: background 0.3s ease, box-shadow 0.3s ease;
        margin: 0 auto;
      }

      .light-theme #canvas-container {
        background: rgba(255, 255, 255, 1);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      }

      .layer-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .layer-item {
        background: rgba(255, 255, 255, 0.15);
        padding: 12px;
        margin-bottom: 8px;
        border-radius: 8px;
        cursor: move;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .layer-item:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateX(5px);
      }

      .layer-item.dragging {
        opacity: 0.5;
        transform: rotate(2deg);
      }

      .layer-item.drag-over {
        border-top: 3px solid white;
      }

      .drag-handle {
        font-size: 1.2rem;
        cursor: grab;
        user-select: none;
      }

      .drag-handle:active {
        cursor: grabbing;
      }

      .layer-checkbox {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      .layer-name {
        flex: 1;
        font-weight: 500;
        font-size: 0.9rem;
      }

      .layer-color {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        border: 2px solid rgba(255, 255, 255, 0.5);
      }

      svg {
        width: 100%;
        height: 100%;
      }

      /* Ensure sector groups have no transforms that could cause displacement */
      .ring-sector-group {
        transform: none !important;
      }

      .ring-sector {
        stroke: rgba(255, 255, 255, 0.1);
        stroke-width: 1.5;
        cursor: pointer;
        transition: opacity 0.2s ease, stroke 0.2s ease;
        pointer-events: all;
        /* Use vector-effect to prevent stroke from affecting layout */
        vector-effect: non-scaling-stroke;
        /* CRITICAL: No transforms, filters, or any effects that could cause position changes */
        transform: none;
        filter: none;
        /* Balanced opacity for dark background */
        opacity: 0.5;
      }

      /* Hover on sector path - precise detection using actual path shape */
      .ring-sector:hover {
        opacity: 0.95;
        stroke: white;
        /* CRITICAL: Keep stroke-width exactly the same to prevent layout shift */
        stroke-width: 1.5;
        /* NO filters, transforms, or effects that could cause visual displacement */
        filter: none;
        transform: none;
      }

      /* Also support group hover for cases where group has pointer events */
      .ring-sector-group:hover .ring-sector {
        opacity: 0.95;
        stroke: white;
        stroke-width: 1.5;
        /* NO filters, transforms, or effects that could cause visual displacement */
        filter: none;
        transform: none;
      }

      .light-theme .ring-sector-group:hover .ring-sector,
      .light-theme .ring-sector:hover {
        stroke: rgba(0, 0, 0, 0.8);
        filter: none;
        transform: none;
      }

      /* Ensure labels stay visible on hover */
      .ring-sector-group:hover .ring-label {
        opacity: 1 !important;
        fill: rgba(0, 0, 0, 0.9) !important;
      }

      .ring-separator {
        fill: none;
        stroke: rgba(0, 0, 0, 0.25);
        stroke-width: 3;
        pointer-events: none;
      }

      .ring-label {
        fill: rgba(0, 0, 0, 0.95);
        font-size: 14px; /* Smaller for better fit */
        font-weight: 700;
        pointer-events: none;
        user-select: none;
        paint-order: stroke fill;
        stroke: rgba(255, 255, 255, 1);
        stroke-width: 5px; /* Increased for better contrast on white background */
        stroke-linecap: round;
        stroke-linejoin: round;
        /* Ensure labels are always visible and on top */
        opacity: 1 !important;
        z-index: 10;
        transition: fill 0.3s ease, stroke 0.3s ease;
      }

      .light-theme .ring-label {
        fill: rgba(0, 0, 0, 0.95);
        stroke: rgba(255, 255, 255, 1);
        stroke-width: 5px;
      }

      .center-text {
        fill: rgba(0, 0, 0, 0.7);
        font-size: 36px; /* Smaller for better fit */
        font-weight: 700;
        text-anchor: middle;
        dominant-baseline: middle;
        pointer-events: none;
        transition: fill 0.3s ease;
      }

      .light-theme .center-text {
        fill: rgba(0, 0, 0, 0.8);
      }

      /* Mobile: Smaller font sizes for better fit */
      @media (max-width: 768px) {
        .ring-label {
          font-size: 10px;
          stroke-width: 2px;
        }

        .center-text {
          font-size: 20px;
        }
      }

      /* Mobile optimizations */
      @media (max-width: 768px) {
        /* Prevent horizontal scrolling */
        html,
        body {
          overflow-x: hidden;
          max-width: 100vw;
        }

        body {
          padding: 5px;
        }

        /* Split header into multiple lines on mobile */
        header > div {
          flex-direction: column;
          align-items: flex-start !important;
          gap: 12px !important;
        }

        header > div > div:first-child {
          flex-wrap: wrap;
          width: 100%;
          gap: 8px !important;
        }

        header > div > div:last-child {
          width: 100%;
          justify-content: flex-start;
        }

        /* Logo on first line */
        header h1 {
          width: 100%;
          margin-bottom: 8px;
        }

        /* Mode selector on second line */
        header [role="radiogroup"] {
          width: 100%;
          margin-bottom: 8px;
        }

        /* Settings buttons on third line */
        header button[id^="toggle"] {
          margin-right: 8px;
        }

        h1 {
          font-size: 1.5rem;
          margin-bottom: 8px;
        }

        .subtitle {
          font-size: 0.8rem;
          margin-bottom: 15px;
        }

        .controls {
          padding: 15px;
          width: 100%;
          max-width: 100%;
          margin-bottom: 15px;
        }

        .control-group {
          margin-bottom: 12px;
        }

        label {
          font-size: 0.85rem;
        }

        .value-display {
          font-size: 0.8rem;
          padding: 2px 8px;
        }

        .main-content {
          flex-direction: column;
          align-items: center;
          gap: 15px;
          width: 100%;
        }

        #canvas-container {
          width: min(95vw, calc(95vh - 200px));
          height: min(95vw, calc(95vh - 200px));
          max-width: none;
          max-height: none;
          min-width: 0;
        }

        .layer-controls {
          width: 90%;
          max-width: 100%;
          min-width: auto;
        }

        .layer-controls h3 {
          font-size: 1rem;
        }

        .layer-item {
          padding: 10px;
          font-size: 0.85rem;
        }

        .ring-label {
          font-size: 11px;
          stroke-width: 2.5px;
        }

        .center-text {
          font-size: 24px;
          font-weight: 600;
        }
        
        .month-label {
          font-size: 13px;
          font-weight: 500;
        }
        
        .date-label {
          font-size: 12px;
        }

        button {
          font-size: 0.85rem !important;
        }
      }

      @media (max-width: 480px) {
        h1 {
          font-size: 1.3rem;
        }

        .subtitle {
          font-size: 0.75rem;
        }

        .controls {
          padding: 12px;
        }

        label {
          font-size: 0.8rem;
          margin-bottom: 6px;
        }

        .layer-controls {
          width: 95%;
        }

        .layer-item {
          padding: 8px;
          gap: 8px;
        }

        .layer-name {
          font-size: 0.8rem;
        }

        .drag-handle {
          font-size: 1rem;
        }

        .ring-label {
          font-size: 10px;
          stroke-width: 2px;
        }

        .center-text {
          font-size: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="min-h-screen flex flex-col w-full">
      <!-- Header with Mode Selector - matches index.html -->
      <header
        class="w-full max-w-7xl mx-auto px-4 sm:px-6 py-4 sm:py-6"
        style="
          overflow-x: hidden;
          position: relative;
          z-index: 1000;
          background: transparent;
        "
      >
        <div
          class="flex flex-col sm:flex-row items-start sm:items-center justify-between flex-wrap gap-3 sm:gap-4"
        >
          <div
            class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-2 w-full sm:w-auto"
          >
            <h1
              class="text-2xl font-bold bg-gradient-to-r from-primary-400 to-primary-600 bg-clip-text text-transparent"
            >
              YearWheel
            </h1>
            <!-- Mode Selector + Settings (Radio Buttons with settings inline) -->
            <div
              class="flex items-center gap-2"
              role="radiogroup"
              aria-label="Select calendar mode"
            >
              <label class="flex items-center gap-1.5 cursor-pointer group">
                <input
                  type="radio"
                  name="headerMode"
                  value="old"
                  id="headerModeOld"
                  class="w-3.5 h-3.5 border-gray-600 text-primary-500 focus:ring-primary-500 cursor-pointer"
                />
                <span
                  class="text-xs text-dark-muted group-hover:text-gray-300 transition-colors"
                  >Classic</span
                >
              </label>
              <label class="flex items-center gap-1.5 cursor-pointer group">
                <input
                  type="radio"
                  name="headerMode"
                  value="rings"
                  id="headerModeRings"
                  class="w-3.5 h-3.5 border-gray-600 text-primary-500 focus:ring-primary-500 cursor-pointer"
                  checked
                />
                <span
                  class="text-xs text-dark-muted group-hover:text-gray-300 transition-colors"
                  >Rings</span
                >
              </label>
              <label class="flex items-center gap-1.5 cursor-pointer group">
                <input
                  type="radio"
                  name="headerMode"
                  value="zoom"
                  id="headerModeZoom"
                  class="w-3.5 h-3.5 border-gray-600 text-primary-500 focus:ring-primary-500 cursor-pointer"
                />
                <span
                  class="text-xs text-dark-muted group-hover:text-gray-300 transition-colors"
                  >Zoom</span
                >
              </label>
              <span class="text-gray-600">|</span>
              <button
                id="toggleSettingsRings"
                class="btn text-xs"
                aria-label="Toggle settings panel"
                title="Settings & Controls"
              >
                ⚙️
              </button>
              <button
                id="toggleAboutRings"
                class="btn text-xs"
                aria-label="Toggle about panel"
                title="About"
              >
                ℹ️
              </button>
            </div>
          </div>

          <!-- Login Status / Sign In Button -->
          <div id="headerAuthRings" class="flex items-center gap-2">
            <!-- Logged In Status (shown when authenticated) -->
            <div
              id="loginStatusRings"
              class="flex items-center gap-2 glass px-3 py-1.5 rounded-lg border border-dark-border text-sm hidden"
            >
              <span class="status-dot w-2 h-2 rounded-full bg-green-500"></span>
              <span class="status-text">Logged in</span>
            </div>

            <!-- Sign In Button (shown when NOT authenticated) -->
            <button
              id="headerSignInBtnRings"
              class="btn primary flex items-center gap-2 text-sm hidden"
              aria-label="Sign in with Google Calendar"
            >
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                />
                <path
                  d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                />
                <path
                  d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                />
                <path
                  d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                />
              </svg>
              <span>Sign in with Google</span>
            </button>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="flex-1 w-full max-w-7xl mx-auto px-6 py-8">
        <div class="grid lg:grid-cols-[1fr_280px] gap-8">
          <!-- Calendar Visualization -->
          <div class="flex flex-col items-center gap-6">
            <div id="canvas-container">
              <svg
                id="calendar-svg"
                viewBox="0 0 700 700"
                preserveAspectRatio="xMidYMid meet"
              >
            <defs>
              <!-- Gradients for each ring -->
              <linearGradient
                id="gradient-seasons"
                x1="0%"
                y1="0%"
                x2="100%"
                y2="100%"
              >
                <stop
                  offset="0%"
                  style="stop-color: #667eea; stop-opacity: 1"
                />
                <stop
                  offset="100%"
                  style="stop-color: #764ba2; stop-opacity: 1"
                />
              </linearGradient>
              <linearGradient
                id="gradient-months"
                x1="0%"
                y1="0%"
                x2="100%"
                y2="100%"
              >
                <stop
                  offset="0%"
                  style="stop-color: #f093fb; stop-opacity: 1"
                />
                <stop
                  offset="100%"
                  style="stop-color: #f5576c; stop-opacity: 1"
                />
              </linearGradient>
              <linearGradient
                id="gradient-hebrew"
                x1="0%"
                y1="0%"
                x2="100%"
                y2="100%"
              >
                <stop
                  offset="0%"
                  style="stop-color: #4facfe; stop-opacity: 1"
                />
                <stop
                  offset="100%"
                  style="stop-color: #00f2fe; stop-opacity: 1"
                />
              </linearGradient>
              <linearGradient
                id="gradient-weeks"
                x1="0%"
                y1="0%"
                x2="100%"
                y2="100%"
              >
                <stop
                  offset="0%"
                  style="stop-color: #43e97b; stop-opacity: 1"
                />
                <stop
                  offset="100%"
                  style="stop-color: #38f9d7; stop-opacity: 1"
                />
              </linearGradient>
              <linearGradient
                id="gradient-holidays"
                x1="0%"
                y1="0%"
                x2="100%"
                y2="100%"
              >
                <stop
                  offset="0%"
                  style="stop-color: #ffeaa7; stop-opacity: 1"
                />
                <stop
                  offset="100%"
                  style="stop-color: #fdcb6e; stop-opacity: 1"
                />
              </linearGradient>
            </defs>

            <!-- Ring groups (rendered by JavaScript) -->
            <g id="rings-container"></g>

            <!-- Today indicator line -->
            <line
              id="todayLine"
              x1="350"
              y1="350"
              x2="350"
              y2="100"
              stroke="#ff4444"
              stroke-width="3"
              stroke-dasharray="5,5"
              opacity="0.8"
              pointer-events="none"
            >
              <animate
                attributeName="opacity"
                values="0.8;1;0.8"
                dur="2s"
                repeatCount="indefinite"
              />
            </line>

            <!-- Today indicator dot at the end of line -->
            <circle
              id="todayDot"
              cx="350"
              cy="100"
              r="6"
              fill="#ff4444"
              stroke="white"
              stroke-width="2"
              pointer-events="none"
            >
              <animate
                attributeName="r"
                values="6;8;6"
                dur="2s"
                repeatCount="indefinite"
              />
            </circle>

            <!-- Center text (will be counter-mirrored by JavaScript in CCW mode) -->
            <text
              class="center-text"
              id="centerText"
              x="350"
              y="350"
              transform-origin="350 350"
            >
              2025
            </text>
          </svg>
            </div>
          </div>

          <!-- Settings Panel (Sidebar on Desktop) -->
          <div class="space-y-4">
            <aside id="settingsPanelRings" class="glass rounded-xl border border-dark-border p-6">
              <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-200">Settings</h2>
              </div>
              
              <div class="space-y-6">
                <!-- Shape Controls -->
                <div class="space-y-3">
                  <h3 class="text-sm font-medium text-gray-300 border-b border-dark-border pb-2">Shape</h3>
                  
                  <!-- Corner Radius -->
                  <div class="flex items-center justify-between">
                    <label for="cornerRadius" class="text-sm text-dark-muted">
                      Corner Radius
                    </label>
                    <input 
                      id="cornerRadius" 
                      type="range" 
                      min="0" 
                      max="100" 
                      value="50"
                      class="w-32 h-2 bg-white/10 rounded-lg appearance-none cursor-pointer
                             [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 
                             [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-primary-500 
                             [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer
                             [&::-moz-range-thumb]:w-4 [&::-moz-range-thumb]:h-4 
                             [&::-moz-range-thumb]:bg-primary-500 [&::-moz-range-thumb]:rounded-full
                             [&::-moz-range-thumb]:border-0 [&::-moz-range-thumb]:cursor-pointer"
                      aria-label="Adjust corner radius to morph between circle and square"
                    />
                  </div>

                  <!-- Ring Width -->
                  <div class="flex items-center justify-between">
                    <label for="ringWidth" class="text-sm text-dark-muted">
                      Ring Width
                    </label>
                    <input 
                      id="ringWidth" 
                      type="range" 
                      min="30" 
                      max="80" 
                      value="50"
                      class="w-32 h-2 bg-white/10 rounded-lg appearance-none cursor-pointer
                             [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 
                             [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-primary-500 
                             [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer
                             [&::-moz-range-thumb]:w-4 [&::-moz-range-thumb]:h-4 
                             [&::-moz-range-thumb]:bg-primary-500 [&::-moz-range-thumb]:rounded-full
                             [&::-moz-range-thumb]:border-0 [&::-moz-range-thumb]:cursor-pointer"
                      aria-label="Adjust ring width"
                    />
                  </div>
                  
                  <!-- Direction Toggle -->
                  <button 
                    id="directionToggle" 
                    class="w-full btn flex items-center justify-between gap-2"
                    aria-label="Toggle time flow direction"
                  >
                    <span class="text-sm">Time flow</span>
                    <div class="flex items-center gap-2">
                      <span class="direction-icon text-lg">↻</span>
                      <span class="text-xs">CW</span>
                    </div>
                  </button>

                  <!-- Shift Seasons -->
                  <button 
                    id="rotateYear" 
                    class="w-full btn flex items-center justify-center gap-2"
                    aria-label="Shift seasons clockwise"
                  >
                    <span class="text-lg">↻</span>
                    <span class="text-sm">Shift Seasons</span>
                  </button>
                </div>

                <!-- Layer Controls -->
                <div class="space-y-3">
                  <div class="flex items-center justify-between">
                    <h3 class="text-sm font-medium text-gray-300 border-b border-dark-border pb-2 flex-1">Layer Controls</h3>
                    <button
                      id="toggleLayerControls"
                      class="btn text-xs ml-2"
                      title="Toggle Layer Controls"
                    >
                      <span id="layerControlsToggleText">▼</span>
                    </button>
                  </div>
                  <div id="layerControlsContent">
                    <p class="text-xs text-dark-muted mb-3">
                      Drag to reorder • Click checkbox to show/hide
                    </p>
                    <ul class="layer-list space-y-2" id="layerList">
                      <!-- Populated by JavaScript -->
                    </ul>
                  </div>
                </div>
              </div>
            </aside>
          </div>
        </div>
      </main>

      <!-- Use TypeScript module for rings mode -->
      <script type="module" src="/rings.ts"></script>

      <!-- Footer -->
      <footer
        class="w-full max-w-7xl mx-auto px-6 py-4 mt-auto border-t border-dark-border"
        style="border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: auto"
      >
        <div
          class="flex flex-col sm:flex-row items-center justify-between gap-4 text-sm"
          style="color: rgba(255, 255, 255, 0.7)"
        >
          <div
            class="flex items-center gap-4 flex-wrap justify-center sm:justify-start"
          >
            <span>YearWheel v0.12.0</span>
            <span>•</span>
            <a
              href="privacy.html"
              style="color: rgba(255, 255, 255, 0.7); transition: color 0.2s"
              onmouseover="this.style.color='rgba(255, 255, 255, 0.9)'"
              onmouseout="this.style.color='rgba(255, 255, 255, 0.7)'"
              >Privacy Policy</a
            >
            <span>•</span>
            <a
              href="terms.html"
              style="color: rgba(255, 255, 255, 0.7); transition: color 0.2s"
              onmouseover="this.style.color='rgba(255, 255, 255, 0.9)'"
              onmouseout="this.style.color='rgba(255, 255, 255, 0.7)'"
              >Terms of Service</a
            >
            <span>•</span>
            <a
              href="agreement.html"
              style="color: rgba(255, 255, 255, 0.7); transition: color 0.2s"
              onmouseover="this.style.color='rgba(255, 255, 255, 0.9)'"
              onmouseout="this.style.color='rgba(255, 255, 255, 0.7)'"
              >User Agreement</a
            >
          </div>
          <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.6)">
            © 2025 YearWheel. All rights reserved.
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>
